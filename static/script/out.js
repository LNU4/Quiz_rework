(()=>{var l=0,d=[];function h(){let t=document.getElementById("main-menu-game-mode-selection-container"),e=document.getElementById("game-container"),n=document.getElementById("city-info"),o=document.getElementById("current-city-index"),s=document.getElementById("user-guess-input"),a=document.getElementById("game-container-submit-guess-button"),i=document.getElementById("next-city-button"),c=document.getElementById("user-guess-info"),u=document.getElementById("game-session-token-header");if(l<d.length){let r=d[l];n.textContent=`Guess the temperature of ${r.name}`,o.textContent=`City ${l+1} of ${d.length}`,s.value="",c.textContent="",a.style.display="block",i.textContent=l===d.length-1?"Finish Game":"Next City",i.style.display="none",e.style.display="flex",t.style.display="none",u.textContent=sessionStorage.getItem("game_session_token")}else w()}function F(){document.getElementById("next-city-button").addEventListener("click",()=>{l===d.length-1?w():(document.getElementById("user-guess-info").textContent="",l++,h())})}async function B(){let t=sessionStorage.getItem("logged_in_user_id");sessionStorage.setItem("score",0);try{let n=await(await fetch("http://localhost:3000/api/menu/create-game-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})})).json();n.success?(d=n.cities,sessionStorage.setItem("game_session_id",n.sessionId),sessionStorage.setItem("game_session_token",n.sessionToken),l=0,h()):console.error("Failed to start game")}catch(e){console.error("Error starting game:",e)}}async function b(){let e=document.getElementById("main-menu-game-mode-selection-session-input").value;if(!e){alert("Please enter a valid session token.");return}try{let o=await(await fetch("http://localhost:3000/api/menu/join-game-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionToken:e})})).json();o.success?(d=o.cities,sessionStorage.setItem("game_session_id",o.sessionId),sessionStorage.setItem("game_session_token",o.sessionToken),sessionStorage.setItem("score",0),l=0,h()):alert("Failed to join game: "+o.error)}catch(n){console.error("Error joining game:",n),alert("An error occurred while trying to join the game.")}}async function k(){let t=d[l],e=document.getElementById("user-guess-input"),n=parseFloat(e.value);try{let s=await(await fetch("http://localhost:3000/api/game/submit-guess",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cityId:t.id,userGuess:n})})).json(),a=parseInt(sessionStorage.getItem("score"))||0;a+=s.pointsGained,sessionStorage.setItem("score",a),document.getElementById("user-guess-info").textContent=s.response,document.getElementById("next-city-button").style.display="block",document.getElementById("game-container-submit-guess-button").style.display="none"}catch(o){console.error("Guess submission error:",o)}}function O(){sessionStorage.removeItem("current_city_index"),sessionStorage.removeItem("game_session_id"),sessionStorage.removeItem("game_session_token"),sessionStorage.removeItem("score"),sessionStorage.removeItem("cities"),m(),document.getElementById("game-container").style.display="none",document.getElementById("game-results-container").style.display="none"}function P(t){let e=document.getElementById("game-results-container");e.textContent=t,e.style.display="flex",e.style.flexDirection="column",e.style.width="20%"}async function w(){let t=document.getElementById("next-city-button");t.style.display="none";let e=sessionStorage.getItem("game_session_id"),n=sessionStorage.getItem("logged_in_user_id"),o=sessionStorage.getItem("score");document.getElementById("user-guess-info").textContent="";try{if((await(await fetch("http://localhost:3000/api/game/finish-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gameSessionId:e,answeringUserId:n,score:o})})).json()).success){P(`Game finished! Your score: ${o}`);let i=document.createElement("button");i.textContent="Go to Main Menu",i.addEventListener("click",O),document.getElementById("game-results-container").appendChild(i),R()}else console.error("Failed to update leaderboard")}catch(s){console.error("Error updating leaderboard:",s)}}async function R(){let t=document.getElementById("main-menu-leaderboard-results-container"),e=sessionStorage.getItem("game_session_token");if(!e){alert("Please enter a valid session token.");return}try{let o=await(await fetch(`http://localhost:3000/api/menu/leaderboard?sessionToken=${e}`)).json();if(o.success){let s=o.scores,a=document.getElementById("main-menu-leaderboard-results-container");if(a.style.display="block",a.innerHTML="",s.length===0){a.textContent="No scores available for this session.";return}let i=document.createElement("table"),c=document.createElement("thead"),u=document.createElement("tbody"),r=document.createElement("tr"),g=document.createElement("th");g.textContent="Username";let y=document.createElement("th");y.textContent="Score",r.appendChild(g),r.appendChild(y),c.appendChild(r),i.appendChild(c),s.forEach(I=>{let p=document.createElement("tr"),E=document.createElement("td");E.textContent=I.username;let f=document.createElement("td");f.textContent=I.score,p.appendChild(E),p.appendChild(f),u.appendChild(p)}),i.appendChild(u),a.appendChild(i),a.style.display="block"}else alert("Failed to fetch leaderboard: "+o.error)}catch(n){console.error("Error fetching leaderboard:",n),alert("An error occurred while trying to fetch the leaderboard.")}}document.addEventListener("DOMContentLoaded",()=>{F()});function m(){let t=document.getElementById("login-container"),e=document.getElementById("register-container"),n=document.getElementById("main-menu-container"),o=document.getElementById("main-menu-game-mode-selection-container"),s=document.getElementById("main-menu-leaderboard-container"),a=document.getElementById("main-menu-leaderboard-results-container");a.style.display="none";let i=document.getElementById("game-container");t.style.display="none",e.style.display="none",n.style.display="flex",o.style.display="none",s.style.display="none",i.style.display="none"}function J(){let t=document.getElementById("main-menu-container"),e=document.getElementById("main-menu-game-mode-selection-container");t.style.display="none",e.style.display="flex"}function M(){J()}function S(){m()}function x(){B()}function v(){b()}function G(){document.getElementById("leaderboard-session-input").value="",document.getElementById("main-menu-leaderboard-results-container").innerHTML="",document.getElementById("main-menu-leaderboard-info-msg").textContent="",D()}function D(){let t=document.getElementById("main-menu-leaderboard-container"),e=document.getElementById("main-menu-container");e.style.display="none",t.style.display="flex",document.getElementById("show-leaderboard-button").addEventListener("click",H),document.getElementById("main-menu-leaderboard-back-button").addEventListener("click",m)}async function H(){let t=document.getElementById("leaderboard-session-input").value;if(!t){alert("Please enter a valid session token.");return}try{let n=await(await fetch(`http://localhost:3000/api/menu/leaderboard?sessionToken=${t}`)).json();n.success?$(n.scores):alert("Failed to fetch leaderboard: "+n.error)}catch(e){console.error("Error fetching leaderboard:",e),alert("An error occurred while trying to fetch the leaderboard.")}}function $(t){let e=document.getElementById("main-menu-leaderboard-results-container");if(e.innerHTML="",t.length===0){e.textContent="No scores available for this session.";return}let n=document.createElement("table"),o=document.createElement("thead"),s=document.createElement("tbody"),a=document.createElement("tr"),i=document.createElement("th");i.textContent="Username";let c=document.createElement("th");c.textContent="Score",a.appendChild(i),a.appendChild(c),o.appendChild(a),n.appendChild(o),t.forEach(u=>{let r=document.createElement("tr"),g=document.createElement("td");g.textContent=u.username;let y=document.createElement("td");y.textContent=u.score,r.appendChild(g),r.appendChild(y),s.appendChild(r)}),n.appendChild(s),e.appendChild(n),e.style.display="block"}function _(){sessionStorage.removeItem("logged_in_user_id"),sessionStorage.removeItem("current_city_index"),sessionStorage.removeItem("game_session_id"),sessionStorage.removeItem("game_session_token"),sessionStorage.removeItem("score"),sessionStorage.removeItem("cities"),window.location.reload()}function L(){let t=document.getElementById("login-container"),e=document.getElementById("register-container"),n=document.getElementById("main-menu-container"),o=document.getElementById("game-container");t.style.display="flex",e.style.display="flex",n.style.display="none",o.style.display="none"}function A(t){let e=document.getElementById("login-form-msg");e.style.display="block",e.textContent=t,setTimeout(()=>{e.style.display="none"},3e3)}async function T(t){t.preventDefault();let e=document.getElementById("login-username").value,n=document.getElementById("login-password").value;try{let s=await(await fetch("http://localhost:3000/api/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:n})})).json();s.success?(sessionStorage.setItem("logged_in_user_id",s.userId),m()):A("Error, could not login. Check your username and password and try again")}catch(o){console.error("Login error:",o),alert("An error occurred during login. Please try again.")}}function j(){let t=document.getElementById("register-container");t.style.display="flex"}function C(t){let e=document.getElementById("register-form-msg");e.style.display="block",e.textContent=t,setTimeout(()=>{e.style.display="none"},3e3)}async function N(t){t.preventDefault();let e=document.getElementById("register-username").value,n=document.getElementById("register-password").value;try{let s=await(await fetch("http://localhost:3000/api/user/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:n})})).json();s.success?(console.log("Created new user with ID:",s.userId),C("Created new user.")):C("Error, could not register user.")}catch(o){console.error("Registration error:",o),C("Registration error: "+o.message)}}function U(){Y(),q(),z(),K(),Q(),sessionStorage.getItem("logged_in_user_id")?m():(L(),j())}function Y(){let t=document.getElementById("login-container");document.getElementById("login-form").addEventListener("submit",T)}function q(){let t=document.getElementById("register-container");document.getElementById("register-form").addEventListener("submit",N)}function z(){let t=document.getElementById("main-menu-play-button");t=t.addEventListener("click",M),document.getElementById("main-menu-leaderboard-button").addEventListener("click",G),document.getElementById("main-menu-logout-button").addEventListener("click",_)}function K(){document.getElementById("main-menu-game-mode-selection-create-new-game-button").addEventListener("click",x),document.getElementById("main-menu-game-mode-selection-join-game-button").addEventListener("click",v),document.getElementById("main-menu-game-mode-selection-back-button").addEventListener("click",S)}function Q(){document.getElementById("game-container-submit-guess-button").addEventListener("click",()=>{k()})}document.addEventListener("DOMContentLoaded",U);})();
